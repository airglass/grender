!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.grender=t():e.grender=t()}(self,(()=>(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{AlterProgress:()=>u,Effect:()=>a,Progress:()=>d,Renderable:()=>r,create:()=>c,extend:()=>l});class s{constructor(e){this.isMouseDown=!1,this.element=e.element,this.subscribers=[],this.event={},this.DPR=e.DPR||window.devicePixelRatio}setStyleSize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}setAttrSize(e,t){this.element.width=e,this.element.height=t}emitSubscribers(e,t){this.subscribers.forEach((s=>s(e,t)))}subscribe(e){this.subscribers.push(e)}}class i{constructor(){this.children=[]}add(e){let t=[].slice.call(arguments,0);return t.forEach((e=>{this.children.push(e)})),t}remove(e){for(let t in this.children)if(e===this.children[t])return this.children.splice(+t,1)[0]}get(e){const t=[];for(let s of this.children)s.name&&s.name===e&&t.push(s);return t}}class n extends s{constructor(e){super(e),this.scene=new i}setSize(e,t){this.element.style.position="absolute",this.element.style.top=0,this.element.style.left=0,this.setAttrSize(e*this.DPR,t*this.DPR),this.setStyleSize(e,t)}clear(){let e=this.element.getContext("2d");return e.clearRect(0,0,e.canvas.width,e.canvas.height),this}render(){let e=this.element.getContext("2d");for(let t of this.scene.children)t.draw&&t.draw(e);return this}reRender(){return this.clear(),this.render()}getElementsContainPoint(e){let t=this.element.getContext("2d");return this.scene.children.map((s=>{if(t.isPointInPath(s.path,e.x,e.y))return s})).filter((e=>e))}}class h extends s{constructor(e){super(e),this.width=e.width||300,this.height=e.height||150,this.rendererManager=new i,this._eventHandler=this._eventHandler.bind(this),this.element.style.position="relative",this.setStyleSize(this.width,this.height),this.updateBounds(),this._setInteractable()}updateBounds(){this.bounds=this.getBounds()}getScrollOffsets(){return{x:window.pageXOffset,y:window.pageYOffset}}getViewportSize(){let e=window;return{x:e.innerWidth,y:e.innerHeight}}getBounds(){let e=this.element.getBoundingClientRect(),t=e.left,s=e.top,i=e.width||e.right-e.left,n=e.height||e.bottom-e.top,h=t+i/2,r=s+n/2;return this.bounds={x:t,y:s,centerX:h,centerY:r,width:i,height:n}}addRenderer(e){let t=document.createElement("canvas"),s=new n({element:t,DPR:this.DPR});return s.setSize(this.bounds.width,this.bounds.height),s.name=e,this.element.appendChild(t),this.rendererManager.add(s)[0]}_setInteractable(){let e=this.element;return e.addEventListener("mousedown",this._eventHandler),e.addEventListener("touchstart",this._eventHandler),e.addEventListener("mousemove",this._eventHandler),e.addEventListener("touchmove",this._eventHandler),e.addEventListener("mouseup",this._eventHandler),e.addEventListener("touchend",this._eventHandler),e.addEventListener("mouseover",this._eventHandler),e.addEventListener("mouseout",this._eventHandler),this}_eventHandler(e){this.updateBounds(),this.event={};let t=e.touches&&e.touches[0];switch(e.type){case"mousedown":this.event.interactor="mouse",this.isMouseDown=!0,this.event.type="touchstart",this.event.x=(e.clientX-this.bounds.x)*this.DPR,this.event.y=(e.clientY-this.bounds.y)*this.DPR;break;case"touchstart":this.event.interactor="finger",this.event.type="touchstart",this.event.x=(t.clientX-this.bounds.x)*this.DPR,this.event.y=(t.clientY-this.bounds.y)*this.DPR;break;case"mousemove":this.event.interactor="mouse",this.event.type="mousemove",this.isMouseDown&&(this.event.type="touchmove"),this.event.x=(e.clientX-this.bounds.x)*this.DPR,this.event.y=(e.clientY-this.bounds.y)*this.DPR;break;case"touchmove":this.event.interactor="finger",this.event.type="touchmove",this.event.x=(t.clientX-this.bounds.x)*this.DPR,this.event.y=(t.clientY-this.bounds.y)*this.DPR;break;case"mouseup":this.event.interactor="mouse",this.isMouseDown=!1,this.event.type="touchend";break;case"touchend":this.event.interactor="finger",this.event.type="touchend";case"mouseover":this.event.interactor="mouse",this.event.type="mouseover";break;case"mouseout":this.event.interactor="mouse",this.event.type="mouseout"}this.emitSubscribers(this.event,e)}}class r{constructor(e){this.line=e&&e.line||1,this.fill=e&&e.fill||"#fff",this.stroke=e&&e.stroke||"#111",this.userData={}}init(){}draw(e){}}class o{constructor(){this.initialized=!1}static generateEmptyFrames(e,t,s){let i=[];for(let n=0;n<s;n++){let s=document.createElement("canvas");s.width=e,s.height=t,i.push(s)}return i}fromImage(e,t,s){let i=new Image;i.onload=()=>{let e=i.width/t,n=i.height,h=o.generateEmptyFrames(e,n,t);for(let s=0;s<t;s++)h[s].getContext("2d").drawImage(i,-s*e,0);this.setFrames(h),this.initialized=!0,s(this)},i.src=e}fromFrames(e){this.setFrames(e),this.initialized=!0}setFrames(e){this.frames=e,this.frameWidth=e[0].width,this.frameHeight=e[0].height,this.frameCounts=e.length,this.currentFrameIndex=0}updateFrames(e,t,s,i){let n=o.generateEmptyFrames(e,t,s);this.setFrames(n);for(let e=0;e<s;e++)i(e,this.frames[e].getContext("2d"))}drawFrame(e,t,s){e.drawImage(this.frames[this.currentFrameIndex],t,s),this.currentFrameIndex++,this.currentFrameIndex>=this.frameCounts&&(this.currentFrameIndex=0)}getSprite(){let e=document.createElement("canvas");e.width=this.frameWidth*this.frameCounts,e.height=this.frameHeight;let t=e.getContext("2d");for(let e=0;e<this.frameCounts;e++)t.drawImage(this.frames[e],this.frameWidth*e,0);return e}}class a extends r{constructor(e){super(e),this.keyframes=new o,this.frameCounts=e&&e.frameCounts||1,this.bounds={x:0,y:0,centerX:0,centerY:0,width:0,height:0}}locate(e,t,s=0){this.bounds.width=this.keyframes.frameWidth,this.bounds.height=this.keyframes.frameHeight;let i=this.bounds.width/2,n=this.bounds.height/2;switch(s){case 0:this.bounds.x=e-i,this.bounds.y=t-n;break;case 1:this.bounds.x=e,this.bounds.y=t;break;case 2:this.bounds.x=e-i,this.bounds.y=t;break;case 3:this.bounds.x=e-this.bounds.width,this.bounds.y=t;break;case 4:this.bounds.x=e-this.bounds.width,this.bounds.y=t-n;break;case 5:this.bounds.x=e-this.bounds.width,this.bounds.y=t-this.bounds.height;break;case 6:this.bounds.x=e-i,this.bounds.y=t-this.bounds.height;break;case 7:this.bounds.x=e,this.bounds.y=t-this.bounds.height;break;case 8:this.bounds.x=e,this.bounds.y=t-n}}draw(e){this.keyframes.initialized&&this.keyframes.drawFrame(e,this.bounds.x,this.bounds.y)}}class d{constructor(e,t,s,i){this.value=this.startValue=e||0,this.endValue=t||1,this.t=s>=0&&s<=1?s:0,this.step=i||.1,this.valueLength=this.endValue-this.startValue}getValue(e){return this.startValue+this.valueLength*e}drive(){let e=this.getValue(this.t);return this.t+=this.step,this.t>1&&(this.t=0),this.value=e}}class u extends d{constructor(e,t,s,i){super(e,t,s,i)}getValue(e){let t;return t=e>=0&&e<.5?this.startValue+this.valueLength*e*2:this.startValue+this.valueLength*(2-2*e),t}}function l(e,t){let s=function(s){e.call(this,s),t._constructor&&t._constructor.call(this,s)};function i(){}for(var n in i.prototype=e.prototype,(s.prototype=new i).constructor=s,t)s.prototype[n]=t[n];return s}function c(e){return new h(e)}return t})()));